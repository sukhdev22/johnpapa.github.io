<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Single Page Apps - Part 10 - Saving, Change Tracking, Commanding, and Validation</title>
    
    <meta name="author" content="John Papa">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

    <!-- Le styles -->
    <link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">

    <link rel="shortcut icon" type="image/x-icon" href="assets/ico/favicon.ico">

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

    <link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">

</head>

<body>
    <nav class="navbar navbar-default visible-xs" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
            <a type="button" class="navbar-toggle nav-link" href="http://github.com/johnpapa">
                <i class="fa fa-github"></i>
            </a>
            
            
            <a type="button" class="navbar-toggle nav-link" href="http://twitter.com/john_papa">
                <i class="fa fa-twitter"></i>
            </a>
            
            
            <a class="navbar-brand" href="/">
                <img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721?s=35" class="img-circle" />
                
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/">Home</a></li>
                <li><a href="/categories.html">Categories</a></li>
                <li><a href="/tags.html">Tags</a></li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>

    <!-- nav-menu-dropdown -->
    <div class="btn-group hidden-xs" id="nav-menu">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <i class="fa fa-bars"></i>
        </button>
        <ul class="dropdown-menu" role="menu">
            <li><a href="/"><i class="fa fa-home"></i>Home</a></li>
            <li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
            <li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
            <li class="divider"></li>
            <li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
        </ul>
    </div>

    <div class="col-sm-4 sidebar hidden-xs hidden-sm not-mobile">
        <!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<h1 class="text-center">John Papa</h1>
	<a href="/">
		<img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721?s=150" class="img-circle" />
	</a>
	<h3 class="title">
		<a href="/"></a>
	</h3>
</header>


<div id="bio" class="text-center">
	Evangelist on the Loose
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/johnpapa">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		 
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/john_papa">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		 
	</ul>

	<div class="sidebar-content">

		<nav id="page-nav">
			<ul class="main-navigation list-unstyled list-inline">
				<li><a href="/about/">About</a></li>
				<li><a href="/articles">Articles</a></li>
				<li><a href="/spa">SPA</a></li>
				<li><a href="/videos">Videos</a></li>
			</ul>
		</nav>

		<h5>Recent Posts</h5>
		<ul class="list-unstyled">
			
				<li>
					<span>16 Sep 2015</span> &raquo;
					<a href="/angular/angular2/community/event/javascript/uncategorized/2015/09/16/angular-2-hack-night-coming-to-orlando.html">
					Angular 2 Hack Night Coming to Orlando</a>
				</li>
			
				<li>
					<span>29 Aug 2015</span> &raquo;
					<a href="/angular/asp.net/github/gulp/html5/javascript/pluralsight/typescript/uncategorized/visual%20studio%20code/2015/08/29/learning-visual-studio-code.html">
					Learning Visual Studio Code</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/visual-studio-code-webinar.html">
					Visual Studio Code Webinar</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/automatically-restarting-asp-net-on-osx-with-dnxmon.html">
					Automatically Restarting ASP.NET on OSX with DNXMON</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/getting-started-with-asp-net-5-on-osx.html">
					Getting Started with ASP.NET 5 on OSX</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/refactoring-with-visual-studio-code.html">
					Refactoring with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/intellisense-witha-visual-studio-code.html">
					Intellisense with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/git-and-preferences-in-visual-studio-code.html">
					Git and Preferences in Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/debugging-with-visual-studio-code.html">
					Debugging with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/visual-studio-code.html">
					Introducing Visual Studio Code</a>
				</li>
			
		</ul>
	</div>

</div>
<!-- sidebar.html end -->
        <div class="not-mobile row sidebar-extras">
            <table class="col-centered">
                <tbody>
                    <tr>
                        <td>
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="160x600"></div>
                        </td>
                        <td>
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="160x600"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="300x250"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="300x250"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="col-sm-8">
        <div class="page-header">
  <h1>Single Page Apps - Part 10 - Saving, Change Tracking, Commanding, and Validation </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   September 
	   9th,
	   
	   2012
	 </span>
	  <div class="article_body">
	  <p>Saving data is simple, right? What app isn’t complete without some sort of saving mechanism? And while I’m at it, it’s nice to be able to track when changes occur so I can tell if a user can press the save button or even leave the current screen. Which bring me to making my buttons smart enough to know that they are already involved in a asynchronous process, so commanding would be nice. Finally, if I want to save data, it might be a good idea to validate the input on the client (and the server).</p>

<p>There are a lot of moving parts involved with saving changes, and I cover these in my new <a href="http://pluralsight.com/">Pluralsight</a> course “<a href="http://jpapa.me/spaps">Single Page Apps with HTML5, ASP.NET Web API, Knockout, and jQuery</a>”.</p>

<p><a href="http://jpapa.me/spaps"><img title="image" src="/wp-content/uploads/media/Windows-Live-Writer/d4d49c57f31e_12ABB/image_9.png" alt="image" width="520" height="108" border="0" /></a></p>

<p>You can catch up on the previous posts in this series here:</p>
<h5>More on the Code Camper SPA</h5>
<p>Part 1 - <a href="http://jpapa.me/spapost1">The Story Begins (What is the Code Camper SPA?)</a></p>

<p>Part 2 - <a href="http://jpapa.me/spapost2">Client Technologies</a></p>

<p>Part 3 - <a href="/spapost3">Server Technologies (the Data Layer)</a></p>

<p>Part 4 - <a href="http://jpapa.me/spapost4">Serving JSON with ASP.NET Web API</a></p>

<p>Part 5 - <a href="http://jpapa.me/spapost5">HTML 5 and ASP.NET Web Optimization</a></p>

<p>Part 6 - <a href="http://jpapa.me/spapost6">JavaScript Modules</a></p>

<p>Part 7 - <a href="http://jpapa.me/spapost7">MVVM and KnockoutJS</a></p>

<p>Part 8 - <a href="http://jpapa.me/spapost8">Data Services on the Client</a></p>

<p>Part 9 - <a href="http://jpapa.me/spapost9">Navigation, Transitions, Storage and Messaging</a></p>

<p>Part 10 - <a href="http://jpapa.me/spapost10">Saving, Change Tracking, and Commanding</a></p>

<p>Part 11 - Responsive Design and Mobility</p>
<h5>Change Tracking</h5>
<p>Change tracking can help make a user’s experience better and frankly, can make a developer’s life a little easier. For example, change tracking makes it easier to disable and enable buttons for saving/canceling changes. If no changes have been made, the buttons should be disabled.</p>

<p><a href="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_4.png"><img style="background-image: none; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_thumb_1.png" alt="image" width="244" height="41" border="0" /></a></p>

<p>If changes have been made, then these buttons would be enabled.</p>

<p><a href="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_6.png"><img style="background-image: none; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_thumb_2.png" alt="image" width="244" height="41" border="0" /></a></p>

<p>We can also prevent users from navigating off the page until they have either saved or canceled their changes.</p>

<p><a href="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_8.png"><img style="background-image: none; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_thumb_3.png" alt="image" width="244" height="54" border="0" /></a></p>

<p>So how do you wire up change tracking with a SPA? The Code Camper SPA uses a custom change tracking tool that ties into <a href="http://knockoutjs.com">KnockoutJS</a>. With some special tips from the KnockoutJS creators (<a href="https://twitter.com/RPNiemeyer">Ryan Niemeyer</a> and <a href="https://twitter.com/stevensanderson">Steve Sanderson</a>) <a href="https://twitter.com/hfjallemark">Hans Fjällemark</a>  and I wrote a component called the DirtyFlag. You can grab the DirtyFlag as part of the <a href="http://jpapa.me/kolitegh">KoLite library on github</a> or grab <a href="https://nuget.org/packages/KoLite">KoLite on NuGet</a>.</p>

<p><a href="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_10.png"><img style="background-image: none; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_thumb_4.png" alt="image" width="244" height="49" border="0" /></a></p>

<p>How do we hook this up?</p>

<ol>
  <li>
    <p>Pull KoLite into your project.</p>
  </li>
  <li>
    <p>Wire up your model and tell it which properties you want to track changes on. (either pass an array of properties or the entire object)</p>
  </li>
</ol>
<pre class="prettyprint">Person = function () {
    var self = this;
    self.id = ko.observable();
    self.firstName = ko.observable();
    self.lastName = ko.observable();
    self.dirtyFlag = new ko.DirtyFlag([
    self.firstName,
    self.lastName);
    return self;
};</pre>
<ol>
  <li>Create a computed property on your viewmodel and check if the model is dirty or not</li>
</ol>
<pre class="prettyprint">isDirty = ko.computed(function() {
    return myPerson().dirtyFlag().isDirty();
})</pre>
<p>Now I can check the isDirty property on the ViewModel to see if changes were made or not. I can bind this property to bindings in the View, such as buttons, too.</p>
<h5>Commanding</h5>
<p>When I’m about to take an asynchronous action that saves data across the wire, I want the user to know the action is still pending (via a activity indicator) and I want to prevent the button from being clicked again. The commanding technique works great for this. Built into KoLite is another component called asyncCommand which handles these situations.</p>

<p>So when a user clicks this button …</p>

<p><a href="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_12.png"><img style="background-image: none; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_thumb_5.png" alt="image" width="244" height="82" border="0" /></a></p>

<p>It should be disabled and show an activity indicator like this …</p>

<p><a href="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_14.png"><img style="background-image: none; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="image" src="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_thumb_6.png" alt="image" width="244" height="71" border="0" /></a></p>

<p>So how do you do this? Pull KoLite into your project and instead of writing a method that saves the data, wrap that in an ko.asyncCommand. Just like the ICommand interface in XAML, asyncCommand has 2 methods you can define: execute and canExecute.</p>
<pre class="prettyprint">saveCmd = ko.asyncCommand({
    execute: function(complete) {
        $.when(datacontext.persons.updateData(speaker()))
            .always(complete);
    },
    canExecute: function(isExecuting) {
        return !isExecuting &amp;&amp; isDirty() &amp;&amp; isValid();
    }
})</pre>
<p>Simply use the execute for the logic that will perform the save and define the conditions when it is appropriate for the user to be able to execute the command. Then in the HTML set the binding to use the command and optionally, the activity indicator.</p>
<pre class="prettyprint"><button data-bind="command: saveCmd, activity: saveCmd.isExecuting"> Save</button></pre>
<h5>Validation</h5>
<p>Validation is a huge part of a good user experience. Users expect to be told how you want the data entered. Nobody wants to enter garbage and have to wait to find out that it’s wrong … or worse, not tell them why its wrong (or even what is wrong).</p>

<p>HTML5 has some great validation support built in, but not everyone can take advantage of HTML5 just yet. So what do we do? This is one reason I like the <a href="https://github.com/ericmbarnard/Knockout-Validation">Knockout.Validation</a> library: it works well without HTML5, but works better with it. This library is written by Eric Barnard and is also available on <a href="https://github.com/ericmbarnard/Knockout-Validation">github</a> and <a href="http://nuget.org/packages/Knockout.Validation">NuGet</a>.</p>

<p>For example, I can make a property required by extending the observable.</p>
<pre class="prettyprint">self.firstName = ko.observable().extend({ required: true });</pre>
<p>You can test this validation out in the <a href="http://johnpapa.aspnet45.cytanium.com/#/speakers/3">live Code Camper demo here</a>.</p>

<p><a href="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_16.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; float: left; padding-top: 0px; border: 0px;" title="image" src="/wp-content/uploads/media/Windows-Live-Writer/395a21820092_1066F/image_thumb_7.png" alt="image" width="464" height="37" align="left" border="0" /></a></p>
<h5>More?</h5>
<p>10 posts is good, but there’s one more to go. In the next and final post I’ll cover mobility and responsive web design.</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#javascript-ref">
					javascript <span>(69)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#jquery-ref">
					jquery <span>(13)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#knockout-ref">
					knockout <span>(26)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#kolite-ref">
					kolite <span>(2)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#nuget-ref">
					nuget <span>(10)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#pluralsight-ref">
					pluralsight <span>(49)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#uncategorized-ref">
					uncategorized <span>(150)</span>
					
				</a></li>
			
		  
		</ul>
		  

		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Single Page Apps - Part 10 - Saving, Change Tracking, Commanding, and Validation&via=john_papa"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721" class="img-rounded author-image" />
        <h4 class="section-title author-name">John Papa</h4>
        <p class="author-bio">Evangelist on the Loose</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/asp.net/html5/javascript/jquery/knockout/pluralsight/web%20api/2012/08/31/spa.html" title="New Pluralsight Course - Single Page Apps with HTML5, ASP.NET Web API, Knockout, jQuery">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/html5/jquery/knockout/pluralsight/spa/web%20api/2012/09/12/2forfree.html" title="Learn about Knockout, HTML5, SPA and ASP.NET Web API for Free!">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'johnpapa';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





      <footer class="footer-text">
        <hr/>
        <p>
        Copyright © 2015 - John Papa Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a>
        | Unless otherwise stated or granted, code samples licensed under the <a href="http://sm.mit-license.org/">MIT license</a>.
        | Site design based on the <a href="https://github.com/dbtek/dbyll">dbyll theme</a> under the <a href="http://sm.mit-license.org/">MIT license</a>
      </p>

      </footer>

    </div>

    <script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/app.js"></script>

    <!--Developer Media Links-->
    <script type='text/javascript'>
        function _dmBootstrap(file) {
    var _dma = document.createElement('script'); _dma.type = 'text/javascript'; _dma.async = true; _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://')
    + file;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
    }
    function _dmFollowup(file) { if (typeof DMAds === 'undefined') _dmBootstrap('cdn2.DeveloperMedia.com/a.min.js');}
    (function () { _dmBootstrap('cdn1.DeveloperMedia.com/a.min.js');
    setTimeout(_dmFollowup, 2000);})();
    </script>

    <!--<script language="JavaScript" src="http://ad.doubleclick.net/N6839/adj/lqm.johnpapa.site/ron;kw=%2Cjohn%2Cpapa%2Cblog%2Cjohnpapa%7Bdot%7Dnet%2Cjohnpapa%2Cpappa%2Cwww%7Bdot%7Djohnpapa%7Bdot%7Dnet%2Cjon%2Cangular%2Cjhon;sz=160x600;dc_ref=http%3A%2F%2Fwww.johnpapa.net%2F;tile=1;ord=BEAAB484DA88D8D84B9DCB004E5712BE?"
    type="text/javascript"></script>-->

    <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="728x90" class="col-centered"></div>

</body>

</html>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'johnpapa']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

